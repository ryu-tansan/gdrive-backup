========================================
Google Shared Drive Backup System
========================================

このシステムは、Google共有ドライブのデータをNASにバックアップします。

========================================
必要な環境
========================================

1. Windows 10/11
2. rcloneがインストール済み
   ダウンロード: https://rclone.org/downloads/
3. Google共有ドライブへのアクセス権限
4. NASへのネットワークアクセス

========================================
初回セットアップ手順
========================================

【ステップ1】rcloneでGoogle共有ドライブを設定

1. コマンドプロンプトまたはPowerShellを開く

2. 以下のコマンドを実行:
   rclone config

3. 以下の手順で設定:
   - n (新規作成)
   - 名前を入力 (例: shared_drive)
   - ストレージタイプで "drive" を選択
   - 以降すべてデフォルト (Enterキー)
   - "Use auto config?" → y (ブラウザでGoogle認証)
   - "Configure this as a Shared Drive?" → y
   - 共有ドライブを選択
   - 確認 → y → q

4. 接続テスト:
   rclone lsd shared_drive:
   (フォルダ一覧が表示されればOK)

【ステップ2】バックアップシステムの設定

1. setup.bat をダブルクリック

2. 画面の指示に従って設定:
   - rclone.exeのパス (通常はデフォルトでOK)
   - NASのパス (例: \\192.168.1.100\backup)
   - rcloneのリモート名 (ステップ1で設定した名前)
   - 保持する世代数 (推奨: 7)

3. 設定内容を確認して保存

【ステップ3】テスト実行

1. backup.bat をダブルクリック

2. エラーなく完了することを確認

3. NAS上にバックアップフォルダが作成されていることを確認

========================================
定期実行の設定（推奨: 週1回）
========================================

【タスクスケジューラの設定】

1. Windowsキー → "タスクスケジューラ" と入力

2. "基本タスクの作成" をクリック

3. 名前: Google Drive Backup

4. トリガー: 毎週

5. 曜日と時刻を選択 (例: 日曜日 午前2時)

6. 操作: プログラムの開始

7. プログラム/スクリプト: backup.bat のフルパスを入力
   例: C:\BackupSystem\backup.bat

8. 完了前に "プロパティを開く" にチェック

9. "条件" タブ:
   - "AC電源で使用..." のチェックを外す
   - "スリープを解除する" にチェック

10. OK で保存

========================================
バックアップされる内容
========================================

以下のファイルが1つのフォルダにバックアップされます:

【通常ファイル】
- PDF、Word、Excel、PowerPoint、画像、動画など
  → そのままコピーされます

【Googleドキュメント類】
- Googleドキュメント → docx形式でエクスポート
- Googleスプレッドシート → xlsx形式でエクスポート
- Googleスライド → pptx形式でエクスポート

すべてのファイルが同じフォルダに保存されるため、
復元時もシンプルです。

========================================
フォルダ構成
========================================

NAS上のフォルダ構成:

\\NASのパス\gdrive\
  ├─ backup_20251124_0200\    ← 最新のバックアップ
  │   ├─ file.pdf             (通常ファイル)
  │   ├─ image.png            (通常ファイル)
  │   ├─ document.docx        (Googleドキュメントからエクスポート)
  │   ├─ spreadsheet.xlsx     (スプレッドシートからエクスポート)
  │   └─ presentation.pptx    (スライドからエクスポート)
  ├─ backup_20251117_0200\    ← 1週間前
  ├─ backup_20251110_0200\    ← 2週間前
  │   ...
  └─ logs\                    (実行ログ)
      ├─ backup_20251124_0200.log
      └─ backup_20251117_0200.log

世代管理:
- 最新7世代（デフォルト設定の場合）が保持されます
- 8世代目以降は自動的に削除されます

========================================
トラブルシューティング
========================================

【エラー: NAS path not accessible】
→ NASの電源、ネットワーク接続を確認
→ ネットワークドライブをマップしてみる:
  net use Z: \\NASのパス /user:ユーザー名 パスワード /persistent:yes

【エラー: Cannot connect to remote】
→ rclone config でリモート名を確認
→ rclone lsd リモート名: でテスト

【エラー: rclone.exe not found】
→ rcloneがインストールされているか確認
→ setup.bat を再実行して正しいパスを設定

【バックアップが実行されない】
→ タスクスケジューラで実行履歴を確認
→ PCが起動していない時間に設定していないか確認
→ backup.bat を手動で実行してエラーを確認

【ログファイルの確認方法】
→ NAS上の logs フォルダ内の .log ファイルをテキストエディタで開く
→ エラーメッセージを確認

【一部のファイルがバックアップされない】
→ ログファイルで "skipped" や "error" を検索
→ ファイル名に特殊文字が含まれている可能性
→ アクセス権限の問題の可能性

========================================
再設定が必要な場合
========================================

1. setup.bat を再度実行
2. 新しい設定で上書き保存される
3. backup.bat で動作確認

========================================
ファイル一覧
========================================

setup.bat   - 初回設定用スクリプト
backup.bat  - バックアップ実行スクリプト
config.ini  - 設定ファイル (setup.bat実行後に自動生成)
README.txt  - このファイル

========================================
よくある質問
========================================

Q: Googleドキュメントを編集したら、バックアップも更新されますか?
A: はい。次回のバックアップ実行時に最新版がエクスポートされます。

Q: 削除したファイルはどうなりますか?
A: 次回バックアップ時には含まれません。
   ただし、過去の世代には残っているので復元可能です。

Q: バックアップ中にGoogle Driveを使用できますか?
A: はい。バックアップは読み取り専用なので影響ありません。

Q: NASの容量が足りなくなったら?
A: 世代数を減らす（setup.batで再設定）か、
   古い世代を手動で削除してください。

Q: 共有ドライブ全体ではなく、特定のフォルダだけバックアップできますか?
A: はい。rclone configで設定するか、
   backup.batのコマンドを修正する必要があります。
   (サポートが必要な場合はお問い合わせください)

========================================
サポート
========================================

問題が発生した場合は、以下の情報を用意してサポートに連絡:

1. エラーメッセージのスクリーンショット
2. ログファイル (NAS上の logs フォルダ内)
3. config.ini の内容 (パスワード情報は含まれません)
4. 実行環境の情報:
   - Windows のバージョン
   - rclone のバージョン (rclone version で確認)
   - NASの種類・モデル

========================================
更新履歴
========================================

v1.1 (2025-11-24)
- 統合アプローチに変更（normalとexportedフォルダを統合）
- 重複バックアップの問題を解消

v1.0 (2025-11-24)
- 初版リリース

========================================
```

---

## 主な変更点まとめ：

### `backup.bat`の変更：

1. **バックアップコマンドを1回に統合**
   - 以前: `normal` と `exported` の2回実行
   - 現在: 1回の実行で全て処理

2. **フォルダ構成の簡略化**
```
   以前: backup_YYYYMMDD_HHMM\normal\
         backup_YYYYMMDD_HHMM\exported\
   
   現在: backup_YYYYMMDD_HHMM\